## 线程同步 --- 互斥量

> 当一个线程访问临界资源时，阻止其它线程访问，保证关键指令的原子性

1. 原子性：一系列操作不可被中断的特性
2. 互斥量：
   - 最简单的线程同步的方法
   - 是处于两态之一的变量：解锁和加锁
   - 两个状态可以保证资源访问的串行
   - 操作系统提供了互斥量的 API

## 线程同步 --- 自旋锁

> 自旋锁是一种多线程同步的变量，使用自旋锁的变量会反复检查锁变量（死循环）是否可用，自旋锁不会让出 CPU，是一种忙等待状态

1. 自旋锁避免了进程或线程上下文切换的开销
2. 操作系统内部很多地方使用的是自旋锁
3. 自旋锁不适合在单核 CPU 使用

## 线程同步 --- 读写锁

> 一种特殊的自旋锁，允许多个读者同时访问，写操作互斥

1. 写和写互斥、写和读互斥

## 线程同步 --- 条件变量

> 允许线程睡眠，直到满足某种条件，当满足条件时，可向该线程发出信号，通知唤醒

1. 条件变量配合互斥量使用

## 线程同步 --- 总结

1. 执行过程

   ![互斥量、自旋锁、读写锁执行过程](.\img\互斥量、自旋锁、读写锁执行过程.png)

![条件变量执行过程](.\img\条件变量执行过程.png)

2. 线程同步的方法对比

![线程同步的方法对比](.\img\线程同步的方法对比.png)

## Fork 

> fork 系统调用用于创建进程，fork 创建的进程初始化状态与父进程一样

1.  fork 无参数
2.  fork 会返回两次，分别返回子进程 id 和 0
   - 返回子进程 id 的是父进程
   - 返回 0 的是子进程

## 进程同步 --- 共享内存

> 允许不相关的进程访问同一片物理内存

1. 共享内存是两个进程之间共享和传递数据最快的方式

2. 共享内存**未提供同步机制**

3. 使用步骤：

   申请共享内存 -> 连接到进程空间 -> 使用共享内存 -> 脱离进程空间 & 删除

## 进程同步 --- Unix 域套接字

> 一种高级的进程间通信的方法

1. 套接字（socket）原是网络通信中使用的术语，Unix 系统 提供的域套接字提供了网络套接字类似的功能

2. 步骤：

   ![Unix套接字](.\img\Unix套接字.png)

